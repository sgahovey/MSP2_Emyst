{% extends 'base.html.twig' %}

{% block title %}Séances{% endblock %}

{% block body %}
<div class="app">
    <main class="content">

        <!-- ===================== -->
        <!--       KPI DASHBOARD   -->
        <!-- ===================== -->
        <div class="grid row-3">
            <div class="card kpi">
                <p class="value">{{ seances|length }}</p>
                <p class="muted">Séances totales</p>
            </div>

            <div class="card kpi">
                <p class="value">
                    {% set total_duree = 0 %}
                    {% for s in seances %}
                        {% if s.duree is not null %}
                            {% set total_duree = total_duree + s.duree|date('U') %}
                        {% endif %}
                    {% endfor %}
                    {{ (total_duree / 3600)|number_format(1) }}h
                </p>
                <p class="muted">Temps total</p>
            </div>

            <div class="card kpi">
                <p class="value">
                    {% if seances|length > 0 %}
                        {{ seances|last.dateEntrainement|date('d/m/Y') }}
                    {% else %}
                        -
                    {% endif %}
                </p>
                <p class="muted">Dernière séance</p>
            </div>
        </div>
        <br>

        <!-- ===================== -->
        <!--   HISTORIQUE SEANCES    -->
        <!-- ===================== -->
        <div class="seances-history-container">
            <div class="seances-history-header">
                <div>
                    <h1 class="seances-history-title">Historique des séances</h1>
                    <p class="seances-history-subtitle">Consultez, filtrez et (optionnellement) modifiez vos séances passées</p>
                </div>
            </div>

            <div class="seances-history-card">
                <table class="seances-history-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Titre</th>
                            <th>Exercices</th>
                            <th>Durée</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for seance in seances %}
                        {% set seanceDate = seance.dateEntrainement|date('Y-m-d') %}
                        {% set todayDate = 'now'|date('Y-m-d') %}
                        {% set isToday = seanceDate == todayDate %}
                        <tr {% if isToday %}class="seance-today"{% endif %}>
                            <td>{{ seance.dateEntrainement|date('d/m/Y') }}</td>
                            <td>{{ seance.typeSeance ? seance.typeSeance.value : '' }}</td>
                            <td>
                                {% if seance.seanceExercices|length > 0 %}
                                    {% for seanceExercice in seance.seanceExercices %}
                                        {{ seanceExercice.exercices.nom }}{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                {% if seance.duree %}
                                    {{ seance.duree|date('H:i') }}
                                {% else %}
                                    --
                                {% endif %}
                            </td>
                            <td>
                                <div class="seances-actions-buttons">
                                    {% if seance.dateEntrainement > date() %}
                                        <a href="{{ path('app_seance_edit', {'id': seance.id}) }}" class="btn-modify">Modifier</a>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="5">Aucune séance encore enregistrée</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>

    </main>
</div>
{% endblock %}
