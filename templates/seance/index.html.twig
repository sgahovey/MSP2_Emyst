{% extends 'base.html.twig' %}

{% block title %}Séances{% endblock %}

{% block body %}
<div class="app">
    <main class="content">

        <!-- ===================== -->
        <!--       KPI DASHBOARD   -->
        <!-- ===================== -->
        <div class="grid row-3">
            <div class="card kpi">
                <p class="value">{{ seances|length }}</p>
                <p class="muted">Séances totales</p>
            </div>

            <div class="card kpi">
                <p class="value">
                    {% set total_duree = 0 %}
                    {% for s in seances %}
                        {% if s.duree is not null %}
                            {% set total_duree = total_duree + s.duree|date('U') %}
                        {% endif %}
                    {% endfor %}
                    {{ (total_duree / 3600)|number_format(1) }}h
                </p>
                <p class="muted">Temps total</p>
            </div>

            <div class="card kpi">
                <p class="value">
                    {% if seances|length > 0 %}
                        {{ seances|last.dateEntrainement|date('d/m/Y') }}
                    {% else %}
                        -
                    {% endif %}
                </p>
                <p class="muted">Dernière séance</p>
            </div>
        </div>
        <br>

        <!-- ===================== -->
        <!--   TABLEAU SEANCES    -->
        <!-- ===================== -->
        <div class="seances-wrapper">

            <div class="card objectifs-card">
                <h2>Historique des séances</h2>

                <table class="seances-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Durée</th>
                            <th class="actions-col">Actions</th>
                        </tr>
                    </thead>

                    <tbody>
                    {% for seance in seances %}
                        <tr>
                            <td>{{ seance.dateEntrainement|date('d/m/Y H:i') }}</td>
                            <td>{{ seance.typeSeance }}</td>
                            <td>
                                {% if seance.duree %}
                                    {{ seance.duree|date('H:i') }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                <div class="actions">
                                    <a class="btn small btn-ghost" href="{{ path('app_seance_show', {'id': seance.id}) }}">voir</a>
                                    <a class="btn small btn-primary" href="{{ path('app_seance_edit', {'id': seance.id}) }}">modifier</a>
                                </div>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="4">Aucune séance encore enregistrée</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <a href="{{ path('app_seance_new') }}" class="btn btn-primary" style="margin-top:15px;">
                    Ajouter une séance
                </a>
            </div>
        </div>

    </main>
</div>
{% endblock %}
